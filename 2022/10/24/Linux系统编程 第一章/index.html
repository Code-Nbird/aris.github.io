<!DOCTYPE html>
<html lang="zn,en">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>Linux系统编程 第一章 - aaaris&#39;s blog</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="Linux系统编程 第一章 - aaaris&#39;s blog" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://aaaris.github.io/2022/10/24/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E4%B8%80%E7%AB%A0/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2022-10-24T12:44:45.562Z" />
  
  <meta property="og:article:author" content="aaaris" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="5"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">aaaris&#39;s blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/projects">Projects</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/aaaris" target="_blank">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        

        
        <div class="date" id="date">
            <span>October</span>
            <span>24,</span>
            <span>2022</span>
        </div>
        

        <h2 class="title">Linux系统编程 第一章</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <p>[TOC]</p>
<h1 id="Linux系统编程"><a href="#Linux系统编程" class="headerlink" title="Linux系统编程"></a>Linux系统编程</h1><h2 id="第-1-章-简介和主要概念"><a href="#第-1-章-简介和主要概念" class="headerlink" title="第 1 章 简介和主要概念"></a>第 1 章 简介和主要概念</h2><h3 id="1-1-系统编程"><a href="#1-1-系统编程" class="headerlink" title="1.1 系统编程"></a>1.1 系统编程</h3><p>从传统角度讲，所有的 Unix 编程都是系统级别编程。</p>
<h4 id="1-1-1-系统调用"><a href="#1-1-1-系统调用" class="headerlink" title="1.1.1 系统调用"></a>1.1.1 系统调用</h4><p>系统调用（syscalls）是为了从操作系统获得服务或者资源而从用户空间向内核发起的函数调用。</p>
<h4 id="1-1-2-调用系统调用"><a href="#1-1-2-调用系统调用" class="headerlink" title="1.1.2 调用系统调用"></a>1.1.2 调用系统调用</h4><p>基于系统安全和稳定的考虑，用户空间程序禁止直接执行内核的代码或者操作内核数据。</p>
<blockquote>
<p>在 i386 上，用户空间程序执行参数为 0x80 的中断指令 int，这个指令触发系统将当前运行环境换到内核的保护区域，内核执行终端处理函数的区域。</p>
</blockquote>
<h4 id="1-1-3-C库"><a href="#1-1-3-C库" class="headerlink" title="1.1.3 C库"></a>1.1.3 C库</h4><p>C库由 GNU libc 提供，简称为 glibc。</p>
<blockquote>
<p>除了标准的C库，glibc 还提供了系统调用封装，线程支持和基本应用工具。</p>
</blockquote>
<h4 id="1-1-4-C编译器"><a href="#1-1-4-C编译器" class="headerlink" title="1.1.4 C编译器"></a>1.1.4 C编译器</h4><p>在 Linux 中，标准的C编译器是 gcc</p>
<blockquote>
<p>GCC——GNU C Compiler</p>
</blockquote>
<h3 id="1-2-API-和-ABI"><a href="#1-2-API-和-ABI" class="headerlink" title="1.2 API 和 ABI"></a>1.2 API 和 ABI</h3><h4 id="1-2-1-API"><a href="#1-2-1-API" class="headerlink" title="1.2.1 API"></a>1.2.1 API</h4><p>API定义了软件模块之间在源代码层交互的接口。</p>
<p>它通过提供一组标准接口的方式进行抽象：一个程序片段调用另一个程序片段。</p>
<blockquote>
<p>API通过C标准来定义且通过C库实现</p>
</blockquote>
<h4 id="1-2-2-ABI"><a href="#1-2-2-ABI" class="headerlink" title="1.2.2 ABI"></a>1.2.2 ABI</h4><p>ABI定义的是，在特定的架构上两个或多个软件模块之间的二进制接口。</p>
<p>它定义了一个应用如何和自己交互，如何和内核以及库进行交互。</p>
<blockquote>
<p>ABI主要关注的问题有：调用约定、字节序、寄存器使用、系统调用、链接、库行为和二进制格式</p>
</blockquote>
<h3 id="1-3-标准"><a href="#1-3-标准" class="headerlink" title="1.3 标准"></a>1.3 标准</h3><p>POSIX 和 SUS 定义了类 Unix 操作系统接口上的 C API，它们有为各种兼容的类 Unix 系统定义了系统编程</p>
<h4 id="1-3-1-POSIX-和-SUS-的历史"><a href="#1-3-1-POSIX-和-SUS-的历史" class="headerlink" title="1.3.1 POSIX 和 SUS 的历史"></a>1.3.1 POSIX 和 SUS 的历史</h4><h4 id="1-3-2-C语言标准"><a href="#1-3-2-C语言标准" class="headerlink" title="1.3.2 C语言标准"></a>1.3.2 C语言标准</h4><p>1999年 ISO C99</p>
<h4 id="1-3-3-Linux-和标准"><a href="#1-3-3-Linux-和标准" class="headerlink" title="1.3.3 Linux 和标准"></a>1.3.3 Linux 和标准</h4><p>Linux 基本规范（LSB） 扩展了 POSIX 和 SUS，添加了自己的标准。</p>
<h4 id="1-3-4-本书和标准"><a href="#1-3-4-本书和标准" class="headerlink" title="1.3.4 本书和标准"></a>1.3.4 本书和标准</h4><p>本书仅设计在2.6内核、gcc 4.2编译器和C库（2.5）的 Linux 系统上的进行系统编程的相关知识。</p>
<h3 id="1-4-Linux编程概念"><a href="#1-4-Linux编程概念" class="headerlink" title="1.4 Linux编程概念"></a>1.4 Linux编程概念</h3><h4 id="1-4-1-文件和文件系统"><a href="#1-4-1-文件和文件系统" class="headerlink" title="1.4.1 文件和文件系统"></a>1.4.1 文件和文件系统</h4><p>Linux 遵循一切皆是文件的理念。</p>
<p>一个打开的文件通过唯一的文件描述符进行引用，该描述符是打开文件的元数据至其本身的映射。</p>
<blockquote>
<p>在 Linux 内核中，这个描述符称为文件描述符，用一个整数表示。</p>
<p>文件描述符在用户程序中共享，允许用户程序用文件描述符直接访问文件。</p>
</blockquote>
<h4 id="1-4-2-普通文件"><a href="#1-4-2-普通文件" class="headerlink" title="1.4.2 普通文件"></a>1.4.2 普通文件</h4><p>一个普通文件包括含以线性字节数组方式组织的数据——字节流。</p>
<p>文件的读写操作，开始于特定字节，指文件位置或者文件偏移量。</p>
<blockquote>
<p>文件中间写入字节将覆盖位置偏移量上的值，因此不能以在中间写入内容的方式来扩展文件。</p>
</blockquote>
<p>文件的大小通过字节计算，称为文件长度。</p>
<blockquote>
<p>截断：通过删除文件结尾部分而截段为稍小的文件。</p>
</blockquote>
<p>内核没有对并发文件访问强加限制。</p>
<p>文件通过 inode（信息节点）进行访问，本身不与文件名称关联。</p>
<blockquote>
<p>inode 是 Unix 文件系统在磁盘上实际物理对象，也是 Linux 内核中的数据结构的概念实体</p>
</blockquote>
<h4 id="1-4-3-目录与链接"><a href="#1-4-3-目录与链接" class="headerlink" title="1.4.3 目录与链接"></a>1.4.3 目录与链接</h4><p>目录将易读的名字和 inode 编号进行映射，目录本身也有关联的 inode 以形成目录层次。</p>
<p>名字与 inode 的配对称为链接。</p>
<p>目录&gt;&gt;映射集合</p>
<p>链接&gt;&gt;映射</p>
<blockquote>
<p>路径解析：用户请求-&gt;内核遍历目录项-&gt;获取下一项 inode 编号-&gt;找到对应 inode</p>
</blockquote>
<h4 id="1-4-4-硬链接"><a href="#1-4-4-硬链接" class="headerlink" title="1.4.4 硬链接"></a>1.4.4 硬链接</h4><p>将不同名字映射到同一个 inode 信息节点的多个连接称为硬链接</p>
<blockquote>
<p>inode 包含一个 link count 来跟踪文件系统中指向该文件的硬连接数目。</p>
<p>当 link count 归0后，inode 和它关联的数据才真正删除。</p>
</blockquote>
<h4 id="1-4-5-符号链接"><a href="#1-4-5-符号链接" class="headerlink" title="1.4.5 符号链接"></a>1.4.5 符号链接</h4><p>符号链接（symlink）拥有自己的inode和包含被链接文件完整路径名的数据块。</p>
<blockquote>
<p>与硬链接相比，符号链接解析需要更多开销（解析两个文件）。</p>
</blockquote>
<h4 id="1-4-6-特殊文件"><a href="#1-4-6-特殊文件" class="headerlink" title="1.4.6 特殊文件"></a>1.4.6 特殊文件</h4><p>Linux 支持四种类型的特殊文件：</p>
<ul>
<li>块设备文件（字节数组）</li>
<li>字符设备文件（字节线性队列）</li>
<li>命名管道（通常叫 FIFOs）(进程间通信 IPC 机制)</li>
<li>Unix 域套接字( IPC 机制)</li>
</ul>
<h4 id="1-4-7-文件系统和名字空间"><a href="#1-4-7-文件系统和名字空间" class="headerlink" title="1.4.7 文件系统和名字空间"></a>1.4.7 文件系统和名字空间</h4><p>Linux 提供全局统一的文件和目录的名字空间。</p>
<blockquote>
<p>每个文件系统都要挂载在名字空间中特定的位置，这个位置称为挂载点。</p>
<p>文件系统的根目录可以通过挂载点访问。</p>
</blockquote>
<h4 id="1-4-8-进程"><a href="#1-4-8-进程" class="headerlink" title="1.4.8 进程"></a>1.4.8 进程</h4><p>Linux 内核支持抢占式多任务和虚拟内存，它给进程提供了虚拟处理器和内存的虚拟视图。</p>
<blockquote>
<p>通过虚拟内存和分页调度，内核允许多个进程共存在系统上，每个进程操作都有自己的地址空间。</p>
</blockquote>
<h4 id="1-4-9-线程"><a href="#1-4-9-线程" class="headerlink" title="1.4.9 线程"></a>1.4.9 线程</h4><p>线程是进程中的活动单位，包括栈、处理器状态、目标代码的当前位置。</p>
<blockquote>
<p>在用户空间，Linux 根据 POSIX1003.1c 实现线程(pthread)</p>
</blockquote>
<h4 id="1-4-10-进程体系"><a href="#1-4-10-进程体系" class="headerlink" title="1.4.10 进程体系"></a>1.4.10 进程体系</h4><p>在 Linux 中，进程树以第一个进程（init）为根，新进程通过 fork() 系统调用创建。</p>
<blockquote>
<p>进程终止，内核将在内存中保存进程的部分内容，允许父进程查询该进程终止的状态。</p>
<p>已终止，但父进程尚未获知其状态的进程，称为僵尸进程（zombie）</p>
</blockquote>
<h4 id="1-4-11-用户和组"><a href="#1-4-11-用户和组" class="headerlink" title="1.4.11 用户和组"></a>1.4.11 用户和组</h4><p>在 Linux 内核中，uid是用户的唯一标识。用户名和对应 id 存储在 &#x2F;etc&#x2F;passwd 中。</p>
<blockquote>
<p>登陆过程中，login(1)程序处理用户名和密码。若无误，login(1) 将根据 &#x2F;etc&#x2F;passwd 为用户生成 login shell</p>
</blockquote>
<p>uid 0 是 root 的用户 id。</p>
<h4 id="1-4-12-权限"><a href="#1-4-12-权限" class="headerlink" title="1.4.12 权限"></a>1.4.12 权限</h4><p>每一个文件都一个所有者，所属组以及权限位集。</p>
<blockquote>
<p>文件所有者和权限信息存储在文件的inode中</p>
</blockquote>
<h4 id="1-4-13-信号"><a href="#1-4-13-信号" class="headerlink" title="1.4.13 信号"></a>1.4.13 信号</h4><p>信号是一种单向异步通知机制，用于通知进程发生某种事件，如段错误或者用户输入 Ctrl + C</p>
<blockquote>
<p>Linux 内核实现了大约30个信号，如 SIGHUP 用于表示终端挂起</p>
</blockquote>
<h4 id="1-4-14-进程间通讯"><a href="#1-4-14-进程间通讯" class="headerlink" title="1.4.14 进程间通讯"></a>1.4.14 进程间通讯</h4><p>Linux 支持的进程间通讯机制包括有</p>
<ul>
<li>管道</li>
<li>命名管道</li>
<li>信号量</li>
<li>消息队列</li>
<li>共享内存</li>
<li>快速用户空间互斥体</li>
</ul>
<h4 id="1-4-15-头文件"><a href="#1-4-15-头文件" class="headerlink" title="1.4.15 头文件"></a>1.4.15 头文件</h4><h4 id="1-4-16-错误处理"><a href="#1-4-16-错误处理" class="headerlink" title="1.4.16 错误处理"></a>1.4.16 错误处理</h4><p>在系统编程中，错误通常通过函数的返回值表示，并通过特殊的变量 errno 描述。</p>
<p>glibc 对库函数和系统调用的 errno 提供透明支持。</p>
<blockquote>
<p>在多线程中，每一个程序都保留了自己的 errno，因此是线程安全的。</p>
</blockquote>
<h3 id="1-5-开始系统编程"><a href="#1-5-开始系统编程" class="headerlink" title="1.5 开始系统编程"></a>1.5 开始系统编程</h3>
    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by aaaris, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2022/10/24/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E4%BA%8C%E7%AB%A0/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">Linux系统编程 第二章</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2022/10/24/hello-world/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">Hello World</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h4 class="title">Blog</h4>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/projects" class="item">Projects</a>
                
                <a href="/resume" class="item">Resume</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h4 class="title">Projects</h4>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h4 class="title">Me</h4>
                
                <a target="_blank" rel="noopener" href="https://github.com/aaaris" class="item">GitHub</a>
                
                <a href="2997600742@qq.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2022 aaaris<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>