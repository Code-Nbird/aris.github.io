<!DOCTYPE html>
<html lang="zn,en">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>Linux系统编程 第十章 - aaaris&#39;s blog</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="Linux系统编程 第十章 - aaaris&#39;s blog" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://aaaris.github.io/2022/10/26/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E5%8D%81%E7%AB%A0/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2022-10-26T14:05:22.739Z" />
  
  <meta property="og:article:author" content="aaaris" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="5"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">aaaris&#39;s blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/projects">Projects</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/aaaris" target="_blank">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        

        
        <div class="date" id="date">
            <span>October</span>
            <span>26,</span>
            <span>2022</span>
        </div>
        

        <h2 class="title">Linux系统编程 第十章</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h1 id="Linux系统编程"><a href="#Linux系统编程" class="headerlink" title="Linux系统编程"></a>Linux系统编程</h1><h2 id="第十章-时间"><a href="#第十章-时间" class="headerlink" title="第十章 时间"></a>第十章 时间</h2><p>内核关心三个时间：</p>
<ul>
<li>墙上时间——真实事件（时间戳）</li>
<li>进程时间——进程消耗时间</li>
<li>单调时间——系统启动时间</li>
</ul>
<blockquote>
<p>Unix 系统使用大纪元——1970 年 1 月 1日 00 : 00 : 00——经过的秒数表示绝对时间。</p>
</blockquote>
<p>Linux 中系统计时器频率被称为 HZ，通常是 100、250、1000。</p>
<p>POSIX 定义 <code>sysconf (_SC_CLK_TCK)</code> 用于获取 HZ。</p>
<h3 id="10-1-时间的数据结构"><a href="#10-1-时间的数据结构" class="headerlink" title="10.1 时间的数据结构"></a>10.1 时间的数据结构</h3><h4 id="10-1-1-原始表示"><a href="#10-1-1-原始表示" class="headerlink" title="10.1.1 原始表示"></a>10.1.1 原始表示</h4><p><code>time_t</code> 表示自大纪元以来已流逝的秒数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line">typdef <span class="type">long</span> <span class="type">time_t</span></span><br></pre></td></tr></table></figure>

<h4 id="10-1-2-毫秒级精度"><a href="#10-1-2-毫秒级精度" class="headerlink" title="10.1.2 毫秒级精度"></a>10.1.2 毫秒级精度</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> &#123;</span></span><br><span class="line">	<span class="type">time_t</span> tv_sec; <span class="comment">/* seconds */</span></span><br><span class="line">	<span class="type">suseconds_t</span> tv_usec; <span class="comment">/* microseconds */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="10-1-3-纳秒级精度"><a href="#10-1-3-纳秒级精度" class="headerlink" title="10.1.3 纳秒级精度"></a>10.1.3 纳秒级精度</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timespec</span> &#123;</span></span><br><span class="line">    <span class="type">time_t</span> tv_sec; <span class="comment">/* seconds */</span></span><br><span class="line">    <span class="type">long</span> tv_nsec; <span class="comment">/* nanoseconds */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>系统计时器没有提供上述进度，故以上结构实际上无法提供所声明的精度。</p>
</blockquote>
<h4 id="10-1-4-“分解”时间"><a href="#10-1-4-“分解”时间" class="headerlink" title="10.1.4 “分解”时间"></a>10.1.4 “分解”时间</h4><p>标准 C 提供结构体 <code>tm</code> 便于进行分解构造字符串。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tm</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> tm_sec; <span class="comment">/* seconds */</span></span><br><span class="line">    <span class="type">int</span> tm_min; <span class="comment">/* minutes */</span></span><br><span class="line">    <span class="type">int</span> tm_hour; <span class="comment">/* hours */</span></span><br><span class="line">    <span class="type">int</span> tm_mday; <span class="comment">/* the day of the month */</span></span><br><span class="line">    <span class="type">int</span> tm_mon; <span class="comment">/* the month */</span></span><br><span class="line">    <span class="type">int</span> tm_year; <span class="comment">/* the year */</span></span><br><span class="line">    <span class="type">int</span> tm_wday; <span class="comment">/* the day of the week */</span></span><br><span class="line">    <span class="type">int</span> tm_yday; <span class="comment">/* the day in the year */</span></span><br><span class="line">    <span class="type">int</span> tm_isdst; <span class="comment">/* daylight savings time? */</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _BSD_SOURCE</span></span><br><span class="line">    <span class="type">long</span> tm_gmtoff; <span class="comment">/* time zone’s offset from GMT */</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *tm_zone; <span class="comment">/* time zone abbreviation */</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* _BSD_SOURCE */</span></span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="10-1-5-一种进程时间类型"><a href="#10-1-5-一种进程时间类型" class="headerlink" title="10.1.5 一种进程时间类型"></a>10.1.5 一种进程时间类型</h4><p><code>clock_t</code> 表示系统实际计时器频率（HZ）或者 <code>CLOCKS_PER_SEC</code>。</p>
<h3 id="10-2-POSIX-时钟"><a href="#10-2-POSIX-时钟" class="headerlink" title="10.2 POSIX 时钟"></a>10.2 POSIX 时钟</h3><p><img src="https://cdn.jsdelivr.net/gh/aaaris/picture/img/image-20221102093034210.png" alt="image-20221102093034210"></p>
<p><img src="https://cdn.jsdelivr.net/gh/aaaris/picture/img/image-20221102093055713.png" alt="image-20221102093055713"></p>
<h3 id="10-3-时间源精度"><a href="#10-3-时间源精度" class="headerlink" title="10.3 时间源精度"></a>10.3 时间源精度</h3><p>POSIX 定义 <code>clock_getres()</code> 函数取得时间源精度</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">clock_getres</span> <span class="params">(<span class="type">clockid_t</span> clock_id, <span class="keyword">struct</span> timespec *res)</span>;</span><br></pre></td></tr></table></figure>

<p>实例代码，输出四种时间源精度：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">clockid_t</span> clocks[] = &#123;</span><br><span class="line">    CLOCK_REALTIME,</span><br><span class="line">    CLOCK_MONOTONIC,</span><br><span class="line">    CLOCK_PROCESS_CPUTIME_ID,</span><br><span class="line">    CLOCK_THREAD_CPUTIME_ID,</span><br><span class="line">    (<span class="type">clockid_t</span>) <span class="number">-1</span> </span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; clocks[i] != (<span class="type">clockid_t</span>) <span class="number">-1</span>; i++) &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timespec</span> <span class="title">res</span>;</span></span><br><span class="line">    <span class="type">int</span> ret;</span><br><span class="line">    ret = clock_getres (clocks[i], &amp;res);</span><br><span class="line">    <span class="keyword">if</span> (ret)</span><br><span class="line">    perror (<span class="string">&quot;clock_getres&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span> (<span class="string">&quot;clock=%d sec=%ld nsec=%ld\n&quot;</span>, </span><br><span class="line">            clocks[i], </span><br><span class="line">            res.tv_sec, </span><br><span class="line">            res.tv_nsec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出示例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aaaris/picture/img/image-20221102094612606.png" alt="image-20221102094612606"></p>
<p>结果显示，<code>CLOCK_REALTIME</code> 和 <code>CLOCK_MONOTONIC</code>和 HZ 精度有关；而<code>CLOCK_PROCESS_CPUTIME_ID</code> 和 <code>CLOCK_THREAD_CPUTIME_ID</code> 使用 TSC，提供纳秒级精度。</p>
<h3 id="10-4-取得当前时间"><a href="#10-4-取得当前时间" class="headerlink" title="10.4 取得当前时间"></a>10.4 取得当前时间</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">time_t</span> <span class="title function_">time</span> <span class="params">(<span class="type">time_t</span> *t)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>time_t</code> 表示时间并不准确，但要点在于计算方法一致。</p>
<p><code>time()</code> 函数返回了当前时间点到linux epoch的秒。</p>
</blockquote>
<h4 id="10-4-1-一个更好的接口"><a href="#10-4-1-一个更好的接口" class="headerlink" title="10.4.1 一个更好的接口"></a>10.4.1 一个更好的接口</h4><p><code>gettimeofday()</code> 扩展了 <code>time()</code> ，提供微秒级精度。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">gettimeofday</span> <span class="params">(<span class="keyword">struct</span> timeval *tv, <span class="keyword">struct</span> timezone *tz)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>timezone 已过时。</p>
</blockquote>
<h4 id="10-4-2-一个高级接口"><a href="#10-4-2-一个高级接口" class="headerlink" title="10.4.2 一个高级接口"></a>10.4.2 一个高级接口</h4><p>POSIX 提供 clock_gettime() 取得指定时间源的时间，如果取两种时间源可达纳秒级精度。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">clock_gettime</span><span class="params">(<span class="type">clockid_t</span> clock_id, <span class="keyword">struct</span> timespec *ts)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="10-4-3-取得进程时间"><a href="#10-4-3-取得进程时间" class="headerlink" title="10.4.3 取得进程时间"></a>10.4.3 取得进程时间</h4><p><code>times()</code> 系统调用可以获取父子进程的进程时间（用户时间和内核时间）。</p>
<p>获取子进程时间前提是：父进程使用 waitpid相关函数且子进程退出后。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/times.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tms</span> &#123;</span></span><br><span class="line">    <span class="type">clock_t</span> tms_utime; <span class="comment">/* user time consumed */</span></span><br><span class="line">    <span class="type">clock_t</span> tms_stime; <span class="comment">/* system time consumed */</span></span><br><span class="line">    <span class="type">clock_t</span> tms_cutime; <span class="comment">/* user time consumed by</span></span><br><span class="line"><span class="comment">    children */</span></span><br><span class="line">    <span class="type">clock_t</span> tms_cstime; <span class="comment">/* system time consumed</span></span><br><span class="line"><span class="comment">    by children */</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">clock_t</span> <span class="title function_">times</span> <span class="params">(<span class="keyword">struct</span> tms *buf)</span>;</span><br></pre></td></tr></table></figure>

<h3 id="10-5-设置当前时间"><a href="#10-5-设置当前时间" class="headerlink" title="10.5 设置当前时间"></a>10.5 设置当前时间</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _SVID_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">stime</span> <span class="params">(<span class="type">time_t</span> *t)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>发起者拥有 <code>CAP_SYS_TIME</code> 权限。</p>
<p><code>stime()</code> 是设定当前时间点到 linux epoch的秒数。</p>
</blockquote>
<h4 id="10-5-1-高精度定时"><a href="#10-5-1-高精度定时" class="headerlink" title="10.5.1 高精度定时"></a>10.5.1 高精度定时</h4><p>与 <code>gettimeofday()</code> 对应的是 <code>settimeofday()</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">settimeofday</span> <span class="params">(<span class="type">const</span> <span class="keyword">struct</span> timeval *tv, <span class="type">const</span> <span class="keyword">struct</span> timezone *tz)</span>;</span><br></pre></td></tr></table></figure>

<p>例子，设置当前时间为 1979 十二月中的一个周六</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv</span> =</span> &#123; .tv_sec = <span class="number">31415926</span>, .tv_usec = <span class="number">27182818</span> &#125;;</span><br><span class="line"><span class="type">int</span> ret;</span><br><span class="line">ret = settimeofday (&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (ret)</span><br><span class="line">	perror (<span class="string">&quot;settimeofday&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="10-5-2-设置时间的一个高级接口"><a href="#10-5-2-设置时间的一个高级接口" class="headerlink" title="10.5.2 设置时间的一个高级接口"></a>10.5.2 设置时间的一个高级接口</h4><p>对应 <code>clock_gettime()</code> 有 <code>clock_settime()</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">clock_settime</span> <span class="params">(<span class="type">clockid_t</span> clock_id, <span class="type">const</span> <span class="keyword">struct</span> timespec *ts)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>一般情况下，只有 CLOCK_REALTIME 可以进行设置。</p>
</blockquote>
<h3 id="10-6-玩转时间"><a href="#10-6-玩转时间" class="headerlink" title="10.6 玩转时间"></a>10.6 玩转时间</h3><p><code>asctime()</code> 将 <code>tm</code> 结构体转换成一个 ASCII 字符串：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> * <span class="title function_">asctime</span> <span class="params">(<span class="type">const</span> <span class="keyword">struct</span> tm *tm)</span>;</span><br><span class="line"><span class="type">char</span> * <span class="title function_">asctime_r</span> <span class="params">(<span class="type">const</span> <span class="keyword">struct</span> tm *tm, <span class="type">char</span> *buf)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>asctime() 返回一个指向静态分配的字符串的指针；asctime() 不是线程安全的。</p>
<p>多线程程序，可以使用 asctime_r()，存储在 buf 中，buf 要求至少具备 26 个字符长度。</p>
</blockquote>
<p>mktime() 将 tm 结构体转换为一个 time_t。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">time_t</span> <span class="title function_">mktime</span> <span class="params">(<span class="keyword">struct</span> tm *tm)</span>;</span><br></pre></td></tr></table></figure>

<p>ctime() 将一个 time_t 转换为 ASCII 表示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> * <span class="title function_">ctime</span> <span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep)</span>;</span><br><span class="line"><span class="type">char</span> * <span class="title function_">ctime_r</span> <span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep, <span class="type">char</span> *buf)</span>;</span><br></pre></td></tr></table></figure>

<p>gmtime() 将 time_t 转换到 tm 结构体，用 UTC 时区格式表示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> tm * <span class="title function_">gmtime</span> <span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep)</span>;</span><br><span class="line"><span class="keyword">struct</span> tm * <span class="title function_">gmtime_r</span> <span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep, <span class="keyword">struct</span> tm *result)</span>;</span><br></pre></td></tr></table></figure>

<p>localtime() 和 localtime_r() 与 gmtime() 类似，但时区格式使用用户时区：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> tm * <span class="title function_">localtime</span> <span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep)</span>;</span><br><span class="line"><span class="keyword">struct</span> tm * <span class="title function_">localtime_r</span> <span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep, <span class="keyword">struct</span> tm *result)</span>;</span><br></pre></td></tr></table></figure>

<p>difftime() 返回两个 time_t 的差值，并转换到双精度浮点型表示相差的秒数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include &lt;time.h&gt;</span><br><span class="line"><span class="type">double</span> <span class="title function_">difftime</span> <span class="params">(<span class="type">time_t</span> time1, <span class="type">time_t</span> time0)</span>;</span><br></pre></td></tr></table></figure>

<p>在所有 POSIX 系统上，time_t 是一个算术类型，等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="type">double</span>) (time1 - time0)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>为保证可移植性，最好使用 <code>difftime()</code>。</p>
</blockquote>
<h3 id="10-7-调校系统时钟"><a href="#10-7-调校系统时钟" class="headerlink" title="10.7 调校系统时钟"></a>10.7 调校系统时钟</h3><p>例子：make 程序通过判断源文件（.c）和目标文件（.o）之间的改动时间戳大小，选择是否重新编译源文件。若用户修改了系统时间后，编辑某源文件，可能会导致该源文件不会被重新编译（时间早于目标文件）。</p>
<p>Unix 提供 <code>adjtime()</code> 函数，避免发生上述情况。</p>
<p><code>adjtime()</code> 函数，指示内核使用 delte 来减缓或加速系统时钟，保证时间单调递增。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _BSD_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">adjtime</span> <span class="params">(<span class="type">const</span> <span class="keyword">struct</span> timeval *delta, <span class="keyword">struct</span> timeval *olddelta)</span>;</span><br></pre></td></tr></table></figure>

<p>Linux 包含 <code>adjtimex()</code> 函数，实现了一个更复杂的算法：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/timex.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">adjtimex</span> <span class="params">(<span class="keyword">struct</span> timex *adj)</span>; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果考虑移植性，应使用 <code>adjtime()</code> 。</p>
</blockquote>
<h3 id="10-8-睡眠和等待"><a href="#10-8-睡眠和等待" class="headerlink" title="10.8 睡眠和等待"></a>10.8 睡眠和等待</h3><p>sleep() 让发起进程睡眠指定秒数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">sleep</span> <span class="params">(<span class="type">unsigned</span> <span class="type">int</span> seconds)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="10-8-1-微秒级精度睡眠"><a href="#10-8-1-微秒级精度睡眠" class="headerlink" title="10.8.1 微秒级精度睡眠"></a>10.8.1 微秒级精度睡眠</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* BSD version */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">usleep</span> <span class="params">(<span class="type">unsigned</span> <span class="type">long</span> usec)</span>;</span><br><span class="line"><span class="comment">/* SUSv2 version */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _XOPEN_SOURCE 500</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">usleep</span> <span class="params">(<span class="type">useconds_t</span> usec)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="10-8-2-Linux-的实时支持"><a href="#10-8-2-Linux-的实时支持" class="headerlink" title="10.8.2 Linux 的实时支持"></a>10.8.2 Linux 的实时支持</h4><p>尽可能满足移植性，Best practices：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> usecs = <span class="number">200</span>;</span><br><span class="line">usleep (usecs);</span><br></pre></td></tr></table></figure>

<h4 id="10-8-3-纳秒级精度睡眠"><a href="#10-8-3-纳秒级精度睡眠" class="headerlink" title="10.8.3 纳秒级精度睡眠"></a>10.8.3 纳秒级精度睡眠</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _POSIX_C_SOURCE 199309</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">nanosleep</span> <span class="params">(<span class="type">const</span> <span class="keyword">struct</span> timespec *req, <span class="keyword">struct</span> timespec *rem)</span>;</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timespec</span> <span class="title">req</span> =</span> &#123; .tv_sec = <span class="number">0</span>, .tv_nsec = <span class="number">200</span> &#125;;</span><br><span class="line"><span class="comment">/* sleep for 200 ns */</span></span><br><span class="line">ret = nanosleep (&amp;req, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (ret)</span><br><span class="line">	perror (<span class="string">&quot;nanosleep&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>nanosleep()</code> 的优点：</p>
<ul>
<li>纳秒级精度</li>
<li>POSIX 标准</li>
<li>不是用信号来实现</li>
</ul>
<h4 id="10-8-4-实现睡眠的高级方法"><a href="#10-8-4-实现睡眠的高级方法" class="headerlink" title="10.8.4 实现睡眠的高级方法"></a>10.8.4 实现睡眠的高级方法</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">clock_nanosleep</span> <span class="params">(<span class="type">clockid_t</span> clock_id,</span></span><br><span class="line"><span class="params">                    <span class="type">int</span> flags,</span></span><br><span class="line"><span class="params">                    <span class="type">const</span> <span class="keyword">struct</span> timespec *req,</span></span><br><span class="line"><span class="params">                    <span class="keyword">struct</span> timespec *rem)</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/aaaris/picture/img/image-20221102111345138.png" alt="image-20221102111345138"></p>
<blockquote>
<p>两者区别在于，<code>clock_nanosleep</code> 可以指定衡量睡眠时间的时间源。</p>
</blockquote>
<p>示例，绝对时间睡眠一秒钟，以避免产生潜在的竞态条件：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timespec</span> <span class="title">ts</span>;</span></span><br><span class="line"><span class="type">int</span> ret;</span><br><span class="line"><span class="comment">/* we want to sleep until one second from NOW */</span></span><br><span class="line">ret = clock_gettime (CLOCK_MONOTONIC, &amp;ts);</span><br><span class="line"><span class="keyword">if</span> (ret) &#123;</span><br><span class="line">    perror (<span class="string">&quot;clock_gettime&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">ts.tv_sec += <span class="number">1</span>;</span><br><span class="line"><span class="built_in">printf</span> (<span class="string">&quot;We want to sleep until sec=%ld nsec=%ld\n&quot;</span>,ts.tv_sec, ts.tv_nsec);</span><br><span class="line">ret = clock_nanosleep (CLOCK_MONOTONIC,TIMER_ABSTIME,&amp;ts, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (ret)</span><br><span class="line">	perror (<span class="string">&quot;clock_nanosleep&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="10-8-5-sleep-的一种可移植实现"><a href="#10-8-5-sleep-的一种可移植实现" class="headerlink" title="10.8.5 sleep 的一种可移植实现"></a>10.8.5 sleep 的一种可移植实现</h4><p>利用 <code>select()</code> 实现可以可移植睡眠（详情跳转 <code>select()</code>）。</p>
<h4 id="10-8-6-超限"><a href="#10-8-6-超限" class="headerlink" title="10.8.6 超限"></a>10.8.6 超限</h4><p>睡眠时间超时：</p>
<ul>
<li>调度行为——选择另外一个任务执行。</li>
<li>定时器超限——定时器粒度大于要求时间间隔。（10ms&#x2F;报时，1ms&#x2F;睡眠）</li>
</ul>
<h4 id="10-8-7-替代睡眠"><a href="#10-8-7-替代睡眠" class="headerlink" title="10.8.7 替代睡眠"></a>10.8.7 替代睡眠</h4><p>文件阻塞——只在需要时唤醒。</p>
<h3 id="10-9-定时器"><a href="#10-9-定时器" class="headerlink" title="10.9 定时器"></a>10.9 定时器</h3><h4 id="10-9-1-简单的闹钟"><a href="#10-9-1-简单的闹钟" class="headerlink" title="10.9.1 简单的闹钟"></a>10.9.1 简单的闹钟</h4><p><code>alaram()</code>配合 <code>signal handler</code> 使用，用于处理 <code>SIGALRM</code> 信号。 </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">alarm</span> <span class="params">(<span class="type">unsigned</span> <span class="type">int</span> seconds)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果先前的信号尚未处理，调用会取消先前信号，使用新的代替，返回剩余秒数。</p>
</blockquote>
<p>示例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">alarm_handler</span> <span class="params">(<span class="type">int</span> signum)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span> (<span class="string">&quot;Five seconds passed!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">func</span> <span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	signal (SIGALRM, alarm_handler);</span><br><span class="line">    alarm (<span class="number">5</span>);</span><br><span class="line">    pause ();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="10-9-2-间歇定时器"><a href="#10-9-2-间歇定时器" class="headerlink" title="10.9.2 间歇定时器"></a>10.9.2 间歇定时器</h4><p>与 <code>alarm()</code>操作不同的是：间歇定时器可以自动重启自身。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">getitimer</span> <span class="params">(<span class="type">int</span> which, <span class="keyword">struct</span> itimerval *value)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">setitimer</span> <span class="params">(<span class="type">int</span> which, </span></span><br><span class="line"><span class="params">               <span class="type">const</span> <span class="keyword">struct</span> itimerval *value,</span></span><br><span class="line"><span class="params">               <span class="keyword">struct</span> itimerval *ovalue)</span>;</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">alarm_handler</span> <span class="params">(<span class="type">int</span> signo)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span> (<span class="string">&quot;Timer hit!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">foo</span> <span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">itimerval</span> <span class="title">delay</span>;</span></span><br><span class="line">    <span class="type">int</span> ret;</span><br><span class="line">    signal (SIGALRM, alarm_handler);</span><br><span class="line">    delay.it_value.tv_sec = <span class="number">5</span>;</span><br><span class="line">    delay.it_value.tv_usec = <span class="number">0</span>;</span><br><span class="line">    delay.it_interval.tv_sec = <span class="number">1</span>;</span><br><span class="line">    delay.it_interval.tv_usec = <span class="number">0</span>;</span><br><span class="line">    ret = setitimer (ITIMER_REAL, &amp;delay, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret) &#123;</span><br><span class="line">        perror (<span class="string">&quot;setitimer&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pause ( );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="10-9-3-高级定时器"><a href="#10-9-3-高级定时器" class="headerlink" title="10.9.3 高级定时器"></a>10.9.3 高级定时器</h4><p>如果优先考虑简洁或者可移植性，那么 <code>setitimer()</code> 是更好的选择。</p>
<h5 id="10-9-3-1-建立一个定时器"><a href="#10-9-3-1-建立一个定时器" class="headerlink" title="10.9.3.1 建立一个定时器"></a>10.9.3.1 建立一个定时器</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">timer_create</span> <span class="params">(<span class="type">clockid_t</span> clockid,</span></span><br><span class="line"><span class="params">                  <span class="keyword">struct</span> sigevent *evp,</span></span><br><span class="line"><span class="params">                  <span class="type">timer_t</span> *timerid)</span>;</span><br></pre></td></tr></table></figure>

<p>进程可以指定定时器的过期行为——<code>sigev_notify</code>:</p>
<p><img src="https://cdn.jsdelivr.net/gh/aaaris/picture/img/image-20221102164643177.png" alt="image-20221102164643177"></p>
<p>示例，定时器到期内核发出 <code>SIGUSER1</code> 信号，并设置 <code>si_value</code> 为存储器定时器ID的地址值：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sigevent</span> <span class="title">evp</span>;</span></span><br><span class="line"><span class="type">timer_t</span> timer;</span><br><span class="line"><span class="type">int</span> ret;</span><br><span class="line">evp.sigev_value.sival_ptr = &amp;timer;</span><br><span class="line">evp.sigev_notify = SIGEV_SIGNAL;</span><br><span class="line">evp.sigev_signo = SIGUSR1;</span><br><span class="line">ret = timer_create (CLOCK_REALTIME, &amp;evp, &amp;timer);</span><br><span class="line"><span class="keyword">if</span> (ret)</span><br><span class="line">	perror (<span class="string">&quot;timer_create&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="10-9-4-设置定时器"><a href="#10-9-4-设置定时器" class="headerlink" title="10.9.4 设置定时器"></a>10.9.4 设置定时器</h4><p><code>time_settime()</code> 将设置 <code>timerid</code>指定的定时器的过期时间为 <code>value</code>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">timer_settime</span> <span class="params">(<span class="type">timer_t</span> timerid,</span></span><br><span class="line"><span class="params">                   <span class="type">int</span> flags,</span></span><br><span class="line"><span class="params">                   <span class="type">const</span> <span class="keyword">struct</span> itimerspec *value,</span></span><br><span class="line"><span class="params">                   <span class="keyword">struct</span> itimerspec *ovalue)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>设置 <code>flags</code> 为 <code>TIMER_ABSTIME</code> 后，可避免产生竞争条件。</p>
</blockquote>
<h5 id="10-9-4-1-取得定时器的过期时间"><a href="#10-9-4-1-取得定时器的过期时间" class="headerlink" title="10.9.4.1 取得定时器的过期时间"></a>10.9.4.1 取得定时器的过期时间</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">timer_gettime</span> <span class="params">(<span class="type">timer_t</span> timerid, <span class="keyword">struct</span> itimerspec *value)</span>;</span><br></pre></td></tr></table></figure>

<h5 id="10-9-4-2-取得定时器的超时值"><a href="#10-9-4-2-取得定时器的超时值" class="headerlink" title="10.9.4.2 取得定时器的超时值"></a>10.9.4.2 取得定时器的超时值</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">timer_getoverrun</span> <span class="params">(<span class="type">timer_t</span> timerid)</span>;</span><br></pre></td></tr></table></figure>

<h5 id="10-9-4-3-删除定时器"><a href="#10-9-4-3-删除定时器" class="headerlink" title="10.9.4.3 删除定时器"></a>10.9.4.3 删除定时器</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">timer_delete</span> <span class="params">(<span class="type">timer_t</span> timerid)</span>;</span><br></pre></td></tr></table></figure>


    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by aaaris, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
    </div>
    

    <div class="container post-prev-next">
        <a class="next"></a>
        
        <a href="/2022/10/25/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E4%B9%9D%E7%AB%A0/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">Linux系统编程 第九章</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h4 class="title">Blog</h4>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/projects" class="item">Projects</a>
                
                <a href="/resume" class="item">Resume</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h4 class="title">Projects</h4>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h4 class="title">Me</h4>
                
                <a target="_blank" rel="noopener" href="https://github.com/aaaris" class="item">GitHub</a>
                
                <a href="2997600742@qq.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2022 aaaris<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>