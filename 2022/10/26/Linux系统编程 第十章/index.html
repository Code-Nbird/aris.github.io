<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Linux系统编程 第十章 | ONLY BULE</title><meta name="author" content="aaaris"><meta name="copyright" content="aaaris"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Linux系统编程 第十章 时间 内核关心三个时间：  墙上时间——真实事件（时间戳） 进程时间——进程消耗时间 单调时间——系统启动时间   Unix 系统使用大纪元——1970 年 1 月 1日 00 : 00 : 00——经过的秒数表示绝对时间。  Linux 中系统计时器频率被称为 HZ，通常是 100、250、1000。 POSIX 定义 sysconf (_SC_CLK_TCK) 用于">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux系统编程 第十章">
<meta property="og:url" content="http://aaaris.github.io/2022/10/26/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E5%8D%81%E7%AB%A0/index.html">
<meta property="og:site_name" content="ONLY BULE">
<meta property="og:description" content="Linux系统编程 第十章 时间 内核关心三个时间：  墙上时间——真实事件（时间戳） 进程时间——进程消耗时间 单调时间——系统启动时间   Unix 系统使用大纪元——1970 年 1 月 1日 00 : 00 : 00——经过的秒数表示绝对时间。  Linux 中系统计时器频率被称为 HZ，通常是 100、250、1000。 POSIX 定义 sysconf (_SC_CLK_TCK) 用于">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic1.zhimg.com/v2-6a22da24bf48ea75bbbd9bc258851cce_720w.jpg?source=172ae18b">
<meta property="article:published_time" content="2022-10-26T14:05:22.739Z">
<meta property="article:modified_time" content="2022-11-05T02:23:54.531Z">
<meta property="article:author" content="aaaris">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic1.zhimg.com/v2-6a22da24bf48ea75bbbd9bc258851cce_720w.jpg?source=172ae18b"><link rel="shortcut icon" href="/img/favicon.webp"><link rel="canonical" href="http://aaaris.github.io/2022/10/26/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E5%8D%81%E7%AB%A0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Linux系统编程 第十章',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-05 10:23:54'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('https://pic1.zhimg.com/v2-6a22da24bf48ea75bbbd9bc258851cce_720w.jpg?source=172ae18b')"><nav id="nav"><span id="blog-info"><a href="/" title="ONLY BULE"><span class="site-name">ONLY BULE</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Linux系统编程 第十章</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-26T14:05:22.739Z" title="发表于 2022-10-26 22:05:22">2022-10-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-05T02:23:54.531Z" title="更新于 2022-11-05 10:23:54">2022-11-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/">Linux系统编程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Linux系统编程 第十章"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>Linux系统编程</h1>
<h2 id="第十章-时间">第十章 时间</h2>
<p>内核关心三个时间：</p>
<ul>
<li>墙上时间——真实事件（时间戳）</li>
<li>进程时间——进程消耗时间</li>
<li>单调时间——系统启动时间</li>
</ul>
<blockquote>
<p>Unix 系统使用大纪元——1970 年 1 月 1日 00 : 00 : 00——经过的秒数表示绝对时间。</p>
</blockquote>
<p>Linux 中系统计时器频率被称为 HZ，通常是 100、250、1000。</p>
<p>POSIX 定义 <code>sysconf (_SC_CLK_TCK)</code> 用于获取 HZ。</p>
<h3 id="10-1-时间的数据结构">10.1 时间的数据结构</h3>
<h4 id="10-1-1-原始表示">10.1.1 原始表示</h4>
<p><code>time_t</code> 表示自大纪元以来已流逝的秒数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line">typdef <span class="type">long</span> <span class="type">time_t</span></span><br></pre></td></tr></table></figure>
<h4 id="10-1-2-毫秒级精度">10.1.2 毫秒级精度</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> &#123;</span></span><br><span class="line">	<span class="type">time_t</span> tv_sec; <span class="comment">/* seconds */</span></span><br><span class="line">	<span class="type">suseconds_t</span> tv_usec; <span class="comment">/* microseconds */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="10-1-3-纳秒级精度">10.1.3 纳秒级精度</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timespec</span> &#123;</span></span><br><span class="line">    <span class="type">time_t</span> tv_sec; <span class="comment">/* seconds */</span></span><br><span class="line">    <span class="type">long</span> tv_nsec; <span class="comment">/* nanoseconds */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>系统计时器没有提供上述进度，故以上结构实际上无法提供所声明的精度。</p>
</blockquote>
<h4 id="10-1-4-“分解”时间">10.1.4 “分解”时间</h4>
<p>标准 C 提供结构体 <code>tm</code> 便于进行分解构造字符串。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tm</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> tm_sec; <span class="comment">/* seconds */</span></span><br><span class="line">    <span class="type">int</span> tm_min; <span class="comment">/* minutes */</span></span><br><span class="line">    <span class="type">int</span> tm_hour; <span class="comment">/* hours */</span></span><br><span class="line">    <span class="type">int</span> tm_mday; <span class="comment">/* the day of the month */</span></span><br><span class="line">    <span class="type">int</span> tm_mon; <span class="comment">/* the month */</span></span><br><span class="line">    <span class="type">int</span> tm_year; <span class="comment">/* the year */</span></span><br><span class="line">    <span class="type">int</span> tm_wday; <span class="comment">/* the day of the week */</span></span><br><span class="line">    <span class="type">int</span> tm_yday; <span class="comment">/* the day in the year */</span></span><br><span class="line">    <span class="type">int</span> tm_isdst; <span class="comment">/* daylight savings time? */</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _BSD_SOURCE</span></span><br><span class="line">    <span class="type">long</span> tm_gmtoff; <span class="comment">/* time zone’s offset from GMT */</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *tm_zone; <span class="comment">/* time zone abbreviation */</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* _BSD_SOURCE */</span></span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="10-1-5-一种进程时间类型">10.1.5 一种进程时间类型</h4>
<p><code>clock_t</code> 表示系统实际计时器频率（HZ）或者 <code>CLOCKS_PER_SEC</code>。</p>
<h3 id="10-2-POSIX-时钟">10.2 POSIX 时钟</h3>
<p><img src="https://cdn.jsdelivr.net/gh/aaaris/picture/img/image-20221102093034210.png" alt="image-20221102093034210"></p>
<p><img src="https://cdn.jsdelivr.net/gh/aaaris/picture/img/image-20221102093055713.png" alt="image-20221102093055713"></p>
<h3 id="10-3-时间源精度">10.3 时间源精度</h3>
<p>POSIX 定义 <code>clock_getres()</code> 函数取得时间源精度</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">clock_getres</span> <span class="params">(<span class="type">clockid_t</span> clock_id, <span class="keyword">struct</span> timespec *res)</span>;</span><br></pre></td></tr></table></figure>
<p>实例代码，输出四种时间源精度：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">clockid_t</span> clocks[] = &#123;</span><br><span class="line">    CLOCK_REALTIME,</span><br><span class="line">    CLOCK_MONOTONIC,</span><br><span class="line">    CLOCK_PROCESS_CPUTIME_ID,</span><br><span class="line">    CLOCK_THREAD_CPUTIME_ID,</span><br><span class="line">    (<span class="type">clockid_t</span>) <span class="number">-1</span> </span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; clocks[i] != (<span class="type">clockid_t</span>) <span class="number">-1</span>; i++) &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timespec</span> <span class="title">res</span>;</span></span><br><span class="line">    <span class="type">int</span> ret;</span><br><span class="line">    ret = clock_getres (clocks[i], &amp;res);</span><br><span class="line">    <span class="keyword">if</span> (ret)</span><br><span class="line">    perror (<span class="string">&quot;clock_getres&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span> (<span class="string">&quot;clock=%d sec=%ld nsec=%ld\n&quot;</span>, </span><br><span class="line">            clocks[i], </span><br><span class="line">            res.tv_sec, </span><br><span class="line">            res.tv_nsec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出示例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/aaaris/picture/img/image-20221102094612606.png" alt="image-20221102094612606"></p>
<p>结果显示，<code>CLOCK_REALTIME</code> 和 <code>CLOCK_MONOTONIC</code>和 HZ 精度有关；而<code>CLOCK_PROCESS_CPUTIME_ID</code> 和 <code>CLOCK_THREAD_CPUTIME_ID</code> 使用 TSC，提供纳秒级精度。</p>
<h3 id="10-4-取得当前时间">10.4 取得当前时间</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">time_t</span> <span class="title function_">time</span> <span class="params">(<span class="type">time_t</span> *t)</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>time_t</code> 表示时间并不准确，但要点在于计算方法一致。</p>
<p><code>time()</code> 函数返回了当前时间点到linux epoch的秒。</p>
</blockquote>
<h4 id="10-4-1-一个更好的接口">10.4.1 一个更好的接口</h4>
<p><code>gettimeofday()</code> 扩展了 <code>time()</code> ，提供微秒级精度。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">gettimeofday</span> <span class="params">(<span class="keyword">struct</span> timeval *tv, <span class="keyword">struct</span> timezone *tz)</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>timezone 已过时。</p>
</blockquote>
<h4 id="10-4-2-一个高级接口">10.4.2 一个高级接口</h4>
<p>POSIX 提供 clock_gettime() 取得指定时间源的时间，如果取两种时间源可达纳秒级精度。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">clock_gettime</span><span class="params">(<span class="type">clockid_t</span> clock_id, <span class="keyword">struct</span> timespec *ts)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="10-4-3-取得进程时间">10.4.3 取得进程时间</h4>
<p><code>times()</code> 系统调用可以获取父子进程的进程时间（用户时间和内核时间）。</p>
<p>获取子进程时间前提是：父进程使用 waitpid相关函数且子进程退出后。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/times.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tms</span> &#123;</span></span><br><span class="line">    <span class="type">clock_t</span> tms_utime; <span class="comment">/* user time consumed */</span></span><br><span class="line">    <span class="type">clock_t</span> tms_stime; <span class="comment">/* system time consumed */</span></span><br><span class="line">    <span class="type">clock_t</span> tms_cutime; <span class="comment">/* user time consumed by</span></span><br><span class="line"><span class="comment">    children */</span></span><br><span class="line">    <span class="type">clock_t</span> tms_cstime; <span class="comment">/* system time consumed</span></span><br><span class="line"><span class="comment">    by children */</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">clock_t</span> <span class="title function_">times</span> <span class="params">(<span class="keyword">struct</span> tms *buf)</span>;</span><br></pre></td></tr></table></figure>
<h3 id="10-5-设置当前时间">10.5 设置当前时间</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _SVID_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">stime</span> <span class="params">(<span class="type">time_t</span> *t)</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>发起者拥有 <code>CAP_SYS_TIME</code> 权限。</p>
<p><code>stime()</code> 是设定当前时间点到 linux epoch的秒数。</p>
</blockquote>
<h4 id="10-5-1-高精度定时">10.5.1 高精度定时</h4>
<p>与 <code>gettimeofday()</code> 对应的是 <code>settimeofday()</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">settimeofday</span> <span class="params">(<span class="type">const</span> <span class="keyword">struct</span> timeval *tv, <span class="type">const</span> <span class="keyword">struct</span> timezone *tz)</span>;</span><br></pre></td></tr></table></figure>
<p>例子，设置当前时间为 1979 十二月中的一个周六</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv</span> =</span> &#123; .tv_sec = <span class="number">31415926</span>, .tv_usec = <span class="number">27182818</span> &#125;;</span><br><span class="line"><span class="type">int</span> ret;</span><br><span class="line">ret = settimeofday (&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (ret)</span><br><span class="line">	perror (<span class="string">&quot;settimeofday&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="10-5-2-设置时间的一个高级接口">10.5.2 设置时间的一个高级接口</h4>
<p>对应 <code>clock_gettime()</code> 有 <code>clock_settime()</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">clock_settime</span> <span class="params">(<span class="type">clockid_t</span> clock_id, <span class="type">const</span> <span class="keyword">struct</span> timespec *ts)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>一般情况下，只有 CLOCK_REALTIME 可以进行设置。</p>
</blockquote>
<h3 id="10-6-玩转时间">10.6 玩转时间</h3>
<p><code>asctime()</code> 将 <code>tm</code> 结构体转换成一个 ASCII 字符串：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> * <span class="title function_">asctime</span> <span class="params">(<span class="type">const</span> <span class="keyword">struct</span> tm *tm)</span>;</span><br><span class="line"><span class="type">char</span> * <span class="title function_">asctime_r</span> <span class="params">(<span class="type">const</span> <span class="keyword">struct</span> tm *tm, <span class="type">char</span> *buf)</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>asctime() 返回一个指向静态分配的字符串的指针；asctime() 不是线程安全的。</p>
<p>多线程程序，可以使用 asctime_r()，存储在 buf 中，buf 要求至少具备 26 个字符长度。</p>
</blockquote>
<p>mktime() 将 tm 结构体转换为一个 time_t。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">time_t</span> <span class="title function_">mktime</span> <span class="params">(<span class="keyword">struct</span> tm *tm)</span>;</span><br></pre></td></tr></table></figure>
<p>ctime() 将一个 time_t 转换为 ASCII 表示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> * <span class="title function_">ctime</span> <span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep)</span>;</span><br><span class="line"><span class="type">char</span> * <span class="title function_">ctime_r</span> <span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep, <span class="type">char</span> *buf)</span>;</span><br></pre></td></tr></table></figure>
<p>gmtime() 将 time_t 转换到 tm 结构体，用 UTC 时区格式表示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> tm * <span class="title function_">gmtime</span> <span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep)</span>;</span><br><span class="line"><span class="keyword">struct</span> tm * <span class="title function_">gmtime_r</span> <span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep, <span class="keyword">struct</span> tm *result)</span>;</span><br></pre></td></tr></table></figure>
<p>localtime() 和 localtime_r() 与 gmtime() 类似，但时区格式使用用户时区：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> tm * <span class="title function_">localtime</span> <span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep)</span>;</span><br><span class="line"><span class="keyword">struct</span> tm * <span class="title function_">localtime_r</span> <span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep, <span class="keyword">struct</span> tm *result)</span>;</span><br></pre></td></tr></table></figure>
<p>difftime() 返回两个 time_t 的差值，并转换到双精度浮点型表示相差的秒数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include &lt;time.h&gt;</span><br><span class="line"><span class="type">double</span> <span class="title function_">difftime</span> <span class="params">(<span class="type">time_t</span> time1, <span class="type">time_t</span> time0)</span>;</span><br></pre></td></tr></table></figure>
<p>在所有 POSIX 系统上，time_t 是一个算术类型，等价于：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="type">double</span>) (time1 - time0)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>为保证可移植性，最好使用 <code>difftime()</code>。</p>
</blockquote>
<h3 id="10-7-调校系统时钟">10.7 调校系统时钟</h3>
<p>例子：make 程序通过判断源文件（.c）和目标文件（.o）之间的改动时间戳大小，选择是否重新编译源文件。若用户修改了系统时间后，编辑某源文件，可能会导致该源文件不会被重新编译（时间早于目标文件）。</p>
<p>Unix 提供 <code>adjtime()</code> 函数，避免发生上述情况。</p>
<p><code>adjtime()</code> 函数，指示内核使用 delte 来减缓或加速系统时钟，保证时间单调递增。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _BSD_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">adjtime</span> <span class="params">(<span class="type">const</span> <span class="keyword">struct</span> timeval *delta, <span class="keyword">struct</span> timeval *olddelta)</span>;</span><br></pre></td></tr></table></figure>
<p>Linux 包含 <code>adjtimex()</code> 函数，实现了一个更复杂的算法：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/timex.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">adjtimex</span> <span class="params">(<span class="keyword">struct</span> timex *adj)</span>; </span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果考虑移植性，应使用 <code>adjtime()</code> 。</p>
</blockquote>
<h3 id="10-8-睡眠和等待">10.8 睡眠和等待</h3>
<p>sleep() 让发起进程睡眠指定秒数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">sleep</span> <span class="params">(<span class="type">unsigned</span> <span class="type">int</span> seconds)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="10-8-1-微秒级精度睡眠">10.8.1 微秒级精度睡眠</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* BSD version */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">usleep</span> <span class="params">(<span class="type">unsigned</span> <span class="type">long</span> usec)</span>;</span><br><span class="line"><span class="comment">/* SUSv2 version */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _XOPEN_SOURCE 500</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">usleep</span> <span class="params">(<span class="type">useconds_t</span> usec)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="10-8-2-Linux-的实时支持">10.8.2 Linux 的实时支持</h4>
<p>尽可能满足移植性，Best practices：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> usecs = <span class="number">200</span>;</span><br><span class="line">usleep (usecs);</span><br></pre></td></tr></table></figure>
<h4 id="10-8-3-纳秒级精度睡眠">10.8.3 纳秒级精度睡眠</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _POSIX_C_SOURCE 199309</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">nanosleep</span> <span class="params">(<span class="type">const</span> <span class="keyword">struct</span> timespec *req, <span class="keyword">struct</span> timespec *rem)</span>;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timespec</span> <span class="title">req</span> =</span> &#123; .tv_sec = <span class="number">0</span>, .tv_nsec = <span class="number">200</span> &#125;;</span><br><span class="line"><span class="comment">/* sleep for 200 ns */</span></span><br><span class="line">ret = nanosleep (&amp;req, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (ret)</span><br><span class="line">	perror (<span class="string">&quot;nanosleep&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><code>nanosleep()</code> 的优点：</p>
<ul>
<li>纳秒级精度</li>
<li>POSIX 标准</li>
<li>不是用信号来实现</li>
</ul>
<h4 id="10-8-4-实现睡眠的高级方法">10.8.4 实现睡眠的高级方法</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">clock_nanosleep</span> <span class="params">(<span class="type">clockid_t</span> clock_id,</span></span><br><span class="line"><span class="params">                    <span class="type">int</span> flags,</span></span><br><span class="line"><span class="params">                    <span class="type">const</span> <span class="keyword">struct</span> timespec *req,</span></span><br><span class="line"><span class="params">                    <span class="keyword">struct</span> timespec *rem)</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/aaaris/picture/img/image-20221102111345138.png" alt="image-20221102111345138"></p>
<blockquote>
<p>两者区别在于，<code>clock_nanosleep</code> 可以指定衡量睡眠时间的时间源。</p>
</blockquote>
<p>示例，绝对时间睡眠一秒钟，以避免产生潜在的竞态条件：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timespec</span> <span class="title">ts</span>;</span></span><br><span class="line"><span class="type">int</span> ret;</span><br><span class="line"><span class="comment">/* we want to sleep until one second from NOW */</span></span><br><span class="line">ret = clock_gettime (CLOCK_MONOTONIC, &amp;ts);</span><br><span class="line"><span class="keyword">if</span> (ret) &#123;</span><br><span class="line">    perror (<span class="string">&quot;clock_gettime&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">ts.tv_sec += <span class="number">1</span>;</span><br><span class="line"><span class="built_in">printf</span> (<span class="string">&quot;We want to sleep until sec=%ld nsec=%ld\n&quot;</span>,ts.tv_sec, ts.tv_nsec);</span><br><span class="line">ret = clock_nanosleep (CLOCK_MONOTONIC,TIMER_ABSTIME,&amp;ts, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (ret)</span><br><span class="line">	perror (<span class="string">&quot;clock_nanosleep&quot;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="10-8-5-sleep-的一种可移植实现">10.8.5 sleep 的一种可移植实现</h4>
<p>利用 <code>select()</code> 实现可以可移植睡眠（详情跳转 <code>select()</code>）。</p>
<h4 id="10-8-6-超限">10.8.6 超限</h4>
<p>睡眠时间超时：</p>
<ul>
<li>调度行为——选择另外一个任务执行。</li>
<li>定时器超限——定时器粒度大于要求时间间隔。（10ms/报时，1ms/睡眠）</li>
</ul>
<h4 id="10-8-7-替代睡眠">10.8.7 替代睡眠</h4>
<p>文件阻塞——只在需要时唤醒。</p>
<h3 id="10-9-定时器">10.9 定时器</h3>
<h4 id="10-9-1-简单的闹钟">10.9.1 简单的闹钟</h4>
<p><code>alaram()</code>配合 <code>signal handler</code> 使用，用于处理 <code>SIGALRM</code> 信号。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">alarm</span> <span class="params">(<span class="type">unsigned</span> <span class="type">int</span> seconds)</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果先前的信号尚未处理，调用会取消先前信号，使用新的代替，返回剩余秒数。</p>
</blockquote>
<p>示例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">alarm_handler</span> <span class="params">(<span class="type">int</span> signum)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span> (<span class="string">&quot;Five seconds passed!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">func</span> <span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	signal (SIGALRM, alarm_handler);</span><br><span class="line">    alarm (<span class="number">5</span>);</span><br><span class="line">    pause ();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="10-9-2-间歇定时器">10.9.2 间歇定时器</h4>
<p>与 <code>alarm()</code>操作不同的是：间歇定时器可以自动重启自身。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">getitimer</span> <span class="params">(<span class="type">int</span> which, <span class="keyword">struct</span> itimerval *value)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">setitimer</span> <span class="params">(<span class="type">int</span> which, </span></span><br><span class="line"><span class="params">               <span class="type">const</span> <span class="keyword">struct</span> itimerval *value,</span></span><br><span class="line"><span class="params">               <span class="keyword">struct</span> itimerval *ovalue)</span>;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">alarm_handler</span> <span class="params">(<span class="type">int</span> signo)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span> (<span class="string">&quot;Timer hit!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">foo</span> <span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">itimerval</span> <span class="title">delay</span>;</span></span><br><span class="line">    <span class="type">int</span> ret;</span><br><span class="line">    signal (SIGALRM, alarm_handler);</span><br><span class="line">    delay.it_value.tv_sec = <span class="number">5</span>;</span><br><span class="line">    delay.it_value.tv_usec = <span class="number">0</span>;</span><br><span class="line">    delay.it_interval.tv_sec = <span class="number">1</span>;</span><br><span class="line">    delay.it_interval.tv_usec = <span class="number">0</span>;</span><br><span class="line">    ret = setitimer (ITIMER_REAL, &amp;delay, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret) &#123;</span><br><span class="line">        perror (<span class="string">&quot;setitimer&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pause ( );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="10-9-3-高级定时器">10.9.3 高级定时器</h4>
<p>如果优先考虑简洁或者可移植性，那么 <code>setitimer()</code> 是更好的选择。</p>
<h5 id="10-9-3-1-建立一个定时器">10.9.3.1 建立一个定时器</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">timer_create</span> <span class="params">(<span class="type">clockid_t</span> clockid,</span></span><br><span class="line"><span class="params">                  <span class="keyword">struct</span> sigevent *evp,</span></span><br><span class="line"><span class="params">                  <span class="type">timer_t</span> *timerid)</span>;</span><br></pre></td></tr></table></figure>
<p>进程可以指定定时器的过期行为——<code>sigev_notify</code>:</p>
<p><img src="https://cdn.jsdelivr.net/gh/aaaris/picture/img/image-20221102164643177.png" alt="image-20221102164643177"></p>
<p>示例，定时器到期内核发出 <code>SIGUSER1</code> 信号，并设置 <code>si_value</code> 为存储器定时器ID的地址值：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sigevent</span> <span class="title">evp</span>;</span></span><br><span class="line"><span class="type">timer_t</span> timer;</span><br><span class="line"><span class="type">int</span> ret;</span><br><span class="line">evp.sigev_value.sival_ptr = &amp;timer;</span><br><span class="line">evp.sigev_notify = SIGEV_SIGNAL;</span><br><span class="line">evp.sigev_signo = SIGUSR1;</span><br><span class="line">ret = timer_create (CLOCK_REALTIME, &amp;evp, &amp;timer);</span><br><span class="line"><span class="keyword">if</span> (ret)</span><br><span class="line">	perror (<span class="string">&quot;timer_create&quot;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="10-9-4-设置定时器">10.9.4 设置定时器</h4>
<p><code>time_settime()</code> 将设置 <code>timerid</code>指定的定时器的过期时间为 <code>value</code>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">timer_settime</span> <span class="params">(<span class="type">timer_t</span> timerid,</span></span><br><span class="line"><span class="params">                   <span class="type">int</span> flags,</span></span><br><span class="line"><span class="params">                   <span class="type">const</span> <span class="keyword">struct</span> itimerspec *value,</span></span><br><span class="line"><span class="params">                   <span class="keyword">struct</span> itimerspec *ovalue)</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>设置 <code>flags</code> 为 <code>TIMER_ABSTIME</code> 后，可避免产生竞争条件。</p>
</blockquote>
<h5 id="10-9-4-1-取得定时器的过期时间">10.9.4.1 取得定时器的过期时间</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">timer_gettime</span> <span class="params">(<span class="type">timer_t</span> timerid, <span class="keyword">struct</span> itimerspec *value)</span>;</span><br></pre></td></tr></table></figure>
<h5 id="10-9-4-2-取得定时器的超时值">10.9.4.2 取得定时器的超时值</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">timer_getoverrun</span> <span class="params">(<span class="type">timer_t</span> timerid)</span>;</span><br></pre></td></tr></table></figure>
<h5 id="10-9-4-3-删除定时器">10.9.4.3 删除定时器</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">timer_delete</span> <span class="params">(<span class="type">timer_t</span> timerid)</span>;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://aaaris.github.io">aaaris</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://aaaris.github.io/2022/10/26/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E5%8D%81%E7%AB%A0/">http://aaaris.github.io/2022/10/26/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E5%8D%81%E7%AB%A0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://aaaris.github.io" target="_blank">ONLY BULE</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://pic1.zhimg.com/v2-6a22da24bf48ea75bbbd9bc258851cce_720w.jpg?source=172ae18b" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/04/TCPIP%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%88%E4%B8%8A%EF%BC%89/" title="TCPIP网络编程 第一部分(上)"><img class="cover" src="https://ts1.cn.mm.bing.net/th/id/R-C.02ec8ba207e11700745f4ae8da647965?rik=Geqb9HR0hLfDyQ&amp;riu=http%3a%2f%2fwww.ituring.com.cn%2fbookcover%2f1284.253.big.jpg&amp;ehk=2eyQptq6FUVnOZjqSK%2fc7U22GY8mFGFLdnQ0IvcVXZ8%3d&amp;risl=&amp;pid=ImgRaw&amp;rto" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">TCPIP网络编程 第一部分(上)</div></div></a></div><div class="next-post pull-right"><a href="/2022/10/25/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E4%B9%9D%E7%AB%A0/" title="Linux系统编程 第九章"><img class="cover" src="https://pic1.zhimg.com/v2-6a22da24bf48ea75bbbd9bc258851cce_720w.jpg?source=172ae18b" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux系统编程 第九章</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">aaaris</div><div class="author-info__description">aaaris is talking here.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/aaaris" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:aaaris011@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Linux系统编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E7%AB%A0-%E6%97%B6%E9%97%B4"><span class="toc-number">1.1.</span> <span class="toc-text">第十章 时间</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E6%97%B6%E9%97%B4%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.1.</span> <span class="toc-text">10.1 时间的数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-1-%E5%8E%9F%E5%A7%8B%E8%A1%A8%E7%A4%BA"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">10.1.1 原始表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-2-%E6%AF%AB%E7%A7%92%E7%BA%A7%E7%B2%BE%E5%BA%A6"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">10.1.2 毫秒级精度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-3-%E7%BA%B3%E7%A7%92%E7%BA%A7%E7%B2%BE%E5%BA%A6"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">10.1.3 纳秒级精度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-4-%E2%80%9C%E5%88%86%E8%A7%A3%E2%80%9D%E6%97%B6%E9%97%B4"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">10.1.4 “分解”时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-5-%E4%B8%80%E7%A7%8D%E8%BF%9B%E7%A8%8B%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">10.1.5 一种进程时间类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-POSIX-%E6%97%B6%E9%92%9F"><span class="toc-number">1.1.2.</span> <span class="toc-text">10.2 POSIX 时钟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-%E6%97%B6%E9%97%B4%E6%BA%90%E7%B2%BE%E5%BA%A6"><span class="toc-number">1.1.3.</span> <span class="toc-text">10.3 时间源精度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-%E5%8F%96%E5%BE%97%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4"><span class="toc-number">1.1.4.</span> <span class="toc-text">10.4 取得当前时间</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-1-%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">10.4.1 一个更好的接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-2-%E4%B8%80%E4%B8%AA%E9%AB%98%E7%BA%A7%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">10.4.2 一个高级接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-3-%E5%8F%96%E5%BE%97%E8%BF%9B%E7%A8%8B%E6%97%B6%E9%97%B4"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">10.4.3 取得进程时间</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-%E8%AE%BE%E7%BD%AE%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4"><span class="toc-number">1.1.5.</span> <span class="toc-text">10.5 设置当前时间</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-1-%E9%AB%98%E7%B2%BE%E5%BA%A6%E5%AE%9A%E6%97%B6"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">10.5.1 高精度定时</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-2-%E8%AE%BE%E7%BD%AE%E6%97%B6%E9%97%B4%E7%9A%84%E4%B8%80%E4%B8%AA%E9%AB%98%E7%BA%A7%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">10.5.2 设置时间的一个高级接口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-%E7%8E%A9%E8%BD%AC%E6%97%B6%E9%97%B4"><span class="toc-number">1.1.6.</span> <span class="toc-text">10.6 玩转时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-7-%E8%B0%83%E6%A0%A1%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%92%9F"><span class="toc-number">1.1.7.</span> <span class="toc-text">10.7 调校系统时钟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-8-%E7%9D%A1%E7%9C%A0%E5%92%8C%E7%AD%89%E5%BE%85"><span class="toc-number">1.1.8.</span> <span class="toc-text">10.8 睡眠和等待</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-1-%E5%BE%AE%E7%A7%92%E7%BA%A7%E7%B2%BE%E5%BA%A6%E7%9D%A1%E7%9C%A0"><span class="toc-number">1.1.8.1.</span> <span class="toc-text">10.8.1 微秒级精度睡眠</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-2-Linux-%E7%9A%84%E5%AE%9E%E6%97%B6%E6%94%AF%E6%8C%81"><span class="toc-number">1.1.8.2.</span> <span class="toc-text">10.8.2 Linux 的实时支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-3-%E7%BA%B3%E7%A7%92%E7%BA%A7%E7%B2%BE%E5%BA%A6%E7%9D%A1%E7%9C%A0"><span class="toc-number">1.1.8.3.</span> <span class="toc-text">10.8.3 纳秒级精度睡眠</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-4-%E5%AE%9E%E7%8E%B0%E7%9D%A1%E7%9C%A0%E7%9A%84%E9%AB%98%E7%BA%A7%E6%96%B9%E6%B3%95"><span class="toc-number">1.1.8.4.</span> <span class="toc-text">10.8.4 实现睡眠的高级方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-5-sleep-%E7%9A%84%E4%B8%80%E7%A7%8D%E5%8F%AF%E7%A7%BB%E6%A4%8D%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.1.8.5.</span> <span class="toc-text">10.8.5 sleep 的一种可移植实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-6-%E8%B6%85%E9%99%90"><span class="toc-number">1.1.8.6.</span> <span class="toc-text">10.8.6 超限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-7-%E6%9B%BF%E4%BB%A3%E7%9D%A1%E7%9C%A0"><span class="toc-number">1.1.8.7.</span> <span class="toc-text">10.8.7 替代睡眠</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-9-%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">1.1.9.</span> <span class="toc-text">10.9 定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-1-%E7%AE%80%E5%8D%95%E7%9A%84%E9%97%B9%E9%92%9F"><span class="toc-number">1.1.9.1.</span> <span class="toc-text">10.9.1 简单的闹钟</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-2-%E9%97%B4%E6%AD%87%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">1.1.9.2.</span> <span class="toc-text">10.9.2 间歇定时器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-3-%E9%AB%98%E7%BA%A7%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">1.1.9.3.</span> <span class="toc-text">10.9.3 高级定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-3-1-%E5%BB%BA%E7%AB%8B%E4%B8%80%E4%B8%AA%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">1.1.9.3.1.</span> <span class="toc-text">10.9.3.1 建立一个定时器</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-4-%E8%AE%BE%E7%BD%AE%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">1.1.9.4.</span> <span class="toc-text">10.9.4 设置定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-4-1-%E5%8F%96%E5%BE%97%E5%AE%9A%E6%97%B6%E5%99%A8%E7%9A%84%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4"><span class="toc-number">1.1.9.4.1.</span> <span class="toc-text">10.9.4.1 取得定时器的过期时间</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-4-2-%E5%8F%96%E5%BE%97%E5%AE%9A%E6%97%B6%E5%99%A8%E7%9A%84%E8%B6%85%E6%97%B6%E5%80%BC"><span class="toc-number">1.1.9.4.2.</span> <span class="toc-text">10.9.4.2 取得定时器的超时值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-4-3-%E5%88%A0%E9%99%A4%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">1.1.9.4.3.</span> <span class="toc-text">10.9.4.3 删除定时器</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/03/14/Obsidian%20+%20GitHub%20Action%20%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E5%8D%9A%E5%AE%A2/" title="Obsidian + GitHub Action 自动部署博客"><img src="https://obsidian.md/images/screenshot-1.0-hero-combo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Obsidian + GitHub Action 自动部署博客"/></a><div class="content"><a class="title" href="/2024/03/14/Obsidian%20+%20GitHub%20Action%20%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E5%8D%9A%E5%AE%A2/" title="Obsidian + GitHub Action 自动部署博客">Obsidian + GitHub Action 自动部署博客</a><time datetime="2024-03-14T03:53:10.367Z" title="发表于 2024-03-14 11:53:10">2024-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/14/SPT-Code%20%E6%A8%A1%E5%9E%8B%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/" title="SPT-Code 模型源码笔记（一）"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SPT-Code 模型源码笔记（一）"/></a><div class="content"><a class="title" href="/2024/03/14/SPT-Code%20%E6%A8%A1%E5%9E%8B%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/" title="SPT-Code 模型源码笔记（一）">SPT-Code 模型源码笔记（一）</a><time datetime="2024-03-13T16:00:00.000Z" title="发表于 2024-03-14 00:00:00">2024-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/12/TCPIP%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86/" title="TCPIP网络编程 第四部分"><img src="https://ts1.cn.mm.bing.net/th/id/R-C.02ec8ba207e11700745f4ae8da647965?rik=Geqb9HR0hLfDyQ&amp;riu=http%3a%2f%2fwww.ituring.com.cn%2fbookcover%2f1284.253.big.jpg&amp;ehk=2eyQptq6FUVnOZjqSK%2fc7U22GY8mFGFLdnQ0IvcVXZ8%3d&amp;risl=&amp;pid=ImgRaw&amp;rto" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TCPIP网络编程 第四部分"/></a><div class="content"><a class="title" href="/2022/11/12/TCPIP%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86/" title="TCPIP网络编程 第四部分">TCPIP网络编程 第四部分</a><time datetime="2022-11-12T10:22:01.065Z" title="发表于 2022-11-12 18:22:01">2022-11-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/09/TCPIP%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86/" title="TCPIP网络编程 第二部分"><img src="https://ts1.cn.mm.bing.net/th/id/R-C.02ec8ba207e11700745f4ae8da647965?rik=Geqb9HR0hLfDyQ&amp;riu=http%3a%2f%2fwww.ituring.com.cn%2fbookcover%2f1284.253.big.jpg&amp;ehk=2eyQptq6FUVnOZjqSK%2fc7U22GY8mFGFLdnQ0IvcVXZ8%3d&amp;risl=&amp;pid=ImgRaw&amp;rto" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TCPIP网络编程 第二部分"/></a><div class="content"><a class="title" href="/2022/11/09/TCPIP%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86/" title="TCPIP网络编程 第二部分">TCPIP网络编程 第二部分</a><time datetime="2022-11-09T15:04:02.308Z" title="发表于 2022-11-09 23:04:02">2022-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/06/TCPIP%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%88%E4%B8%8B%EF%BC%89/" title="TCPIP网络编程 第一部分(下)"><img src="https://ts1.cn.mm.bing.net/th/id/R-C.02ec8ba207e11700745f4ae8da647965?rik=Geqb9HR0hLfDyQ&amp;riu=http%3a%2f%2fwww.ituring.com.cn%2fbookcover%2f1284.253.big.jpg&amp;ehk=2eyQptq6FUVnOZjqSK%2fc7U22GY8mFGFLdnQ0IvcVXZ8%3d&amp;risl=&amp;pid=ImgRaw&amp;rto" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TCPIP网络编程 第一部分(下)"/></a><div class="content"><a class="title" href="/2022/11/06/TCPIP%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%20%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%88%E4%B8%8B%EF%BC%89/" title="TCPIP网络编程 第一部分(下)">TCPIP网络编程 第一部分(下)</a><time datetime="2022-11-06T12:50:08.635Z" title="发表于 2022-11-06 20:50:08">2022-11-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By aaaris</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>